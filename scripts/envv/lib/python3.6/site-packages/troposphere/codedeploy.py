# Copyright (c) 2015, Mark Peek <mark@peek.org>
# All rights reserved.
#
# See LICENSE file for full license.

from . import AWSObject, AWSProperty
from .validators import boolean, positive_integer


KEY_ONLY = "KEY_ONLY"
VALUE_ONLY = "VALUE_ONLY"
KEY_AND_VALUE = "KEY_AND_VALUE"


class GitHubLocation(AWSProperty):
    props = {
        'CommitId': (str, True),
        'Repository': (str, True),
    }


class S3Location(AWSProperty):
    props = {
        'Bucket': (str, True),
        'BundleType': (str, True),
        'ETag': (str, False),
        'Key': (str, True),
        'Version': (str, False),
    }


class Revision(AWSProperty):
    props = {
        'GitHubLocation': (GitHubLocation, False),
        'RevisionType': (str, False),
        'S3Location': (S3Location, False),
    }


class Deployment(AWSProperty):
    props = {
        'Description': (str, False),
        'IgnoreApplicationStopFailures': (bool, False),
        'Revision': (Revision, True),
    }


class Ec2TagFilters(AWSProperty):
    props = {
        'Key': (str, False),
        'Type': (str, False),
        'Value': (str, False),
    }


class OnPremisesInstanceTagFilters(AWSProperty):
    props = {
        'Key': (str, False),
        'Type': (str, False),
        'Value': (str, False),
    }


class MinimumHealthyHosts(AWSProperty):
    props = {
        'Type': (str, False),
        'Value': (positive_integer, False),
    }


class Application(AWSObject):
    resource_type = "AWS::CodeDeploy::Application"

    props = {
        'ApplicationName': (str, False),
    }


class DeploymentConfig(AWSObject):
    resource_type = "AWS::CodeDeploy::DeploymentConfig"

    props = {
        'DeploymentConfigName': (str, False),
        'MinimumHealthyHosts': (MinimumHealthyHosts, False),
    }


class Alarm(AWSProperty):
    props = {
        'Name': (str, False),
    }


class AlarmConfiguration(AWSProperty):
    props = {
        'Alarms': ([Alarm], False),
        'Enabled': (boolean, False),
        'IgnorePollAlarmFailure': (boolean, False),
    }


class TriggerConfig(AWSProperty):
    props = {
        'TriggerEvents': ([str], False),
        'TriggerName': (str, False),
        'TriggerTargetArn': (str, False),
    }


class DeploymentGroup(AWSObject):
    resource_type = "AWS::CodeDeploy::DeploymentGroup"

    props = {
        'AlarmConfiguration': (AlarmConfiguration, False),
        'ApplicationName': (str, True),
        'AutoScalingGroups': ([str], False),
        'Deployment': (Deployment, False),
        'DeploymentConfigName': (str, False),
        'DeploymentGroupName': (str, False),
        'Ec2TagFilters': ([Ec2TagFilters], False),
        'OnPremisesInstanceTagFilters': (OnPremisesInstanceTagFilters, False),
        'ServiceRoleArn': (str, True),
        'TriggerConfigurations': ([TriggerConfig], False),
    }
