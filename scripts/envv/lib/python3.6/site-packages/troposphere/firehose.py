# Copyright (c) 2016, troposphere project
# All rights reserved.
#
# See LICENSE file for full license.

from . import AWSObject, AWSProperty
from .validators import boolean, positive_integer


class BufferingHints(AWSProperty):
    props = {
        'IntervalInSeconds': (positive_integer, True),
        'SizeInMBs': (positive_integer, True)
    }


class CloudWatchLoggingOptions(AWSProperty):
    props = {
        'Enabled': (boolean, False),
        'LogGroupName': (str, False),  # Conditional
        'LogStreamName': (str, False),  # Conditional
    }


class RetryOptions(AWSProperty):
    props = {
        'DurationInSeconds': (positive_integer, True),
    }


class KMSEncryptionConfig(AWSProperty):
    props = {
        'AWSKMSKeyARN': (str, True),
    }


class EncryptionConfiguration(AWSProperty):
    props = {
        'KMSEncryptionConfig': (KMSEncryptionConfig, False),
        'NoEncryptionConfig': (str, False),
    }


class S3Configuration(AWSProperty):
    props = {
        'BucketARN': (str, True),
        'BufferingHints': (BufferingHints, True),
        'CloudWatchLoggingOptions': (CloudWatchLoggingOptions, False),
        'CompressionFormat': (str, True),
        'EncryptionConfiguration': (EncryptionConfiguration, False),
        'Prefix': (str, True),
        'RoleARN': (str, True)
    }


class CopyCommand(AWSProperty):
    props = {
        'CopyOptions': (str, False),
        'DataTableColumns': (str, False),
        'DataTableName': (str, True),
    }


class ElasticsearchDestinationConfiguration(AWSProperty):
    props = {
        'BufferingHints': (BufferingHints, True),
        'CloudWatchLoggingOptions': (CloudWatchLoggingOptions, False),
        'DomainARN': (str, True),
        'IndexName': (str, True),
        'IndexRotationPeriod': (str, True),
        'RetryOptions': (RetryOptions, False),
        'RoleARN': (str, True),
        'S3BackupMode': (str, True),
        'S3Configuration': (S3Configuration, False),
        'TypeName': (str, True),
    }


class RedshiftDestinationConfiguration(AWSProperty):
    props = {
        'CloudWatchLoggingOptions': (CloudWatchLoggingOptions, False),
        'ClusterJDBCURL': (str, True),
        'CopyCommand': (CopyCommand, True),
        'Password': (str, True),
        'RoleARN': (str, True),
        'S3Configuration': (S3Configuration, True),
        'Username': (str, True),
    }


class S3DestinationConfiguration(AWSProperty):
    props = {
        'BucketARN': (str, True),
        'BufferingHints': (BufferingHints, True),
        'CloudWatchLoggingOptions': (CloudWatchLoggingOptions, False),
        'CompressionFormat': (str, True),
        'EncryptionConfiguration': (EncryptionConfiguration, False),
        'Prefix': (str, True),
        'RoleARN': (str, True),
    }


class DeliveryStream(AWSObject):
    resource_type = "AWS::KinesisFirehose::DeliveryStream"

    props = {
        'DeliveryStreamName': (str, False),
        'ElasticsearchDestinationConfiguration': (ElasticsearchDestinationConfiguration, False),  # noqa
        'RedshiftDestinationConfiguration': (RedshiftDestinationConfiguration, False),  # noqa
        'S3DestinationConfiguration': (S3DestinationConfiguration, False),
    }
